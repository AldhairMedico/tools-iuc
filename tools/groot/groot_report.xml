<tool id="groot_report" name="Groot report" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>to generate a resistome profile</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="xrefs"/>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
cp '$bamFile' 'input.bam'
&&
groot report
    --bamFile 'input.bam'
    #if $arg_report.criteria == 'cutoff'
    --covCutoff $arg_report.covCutoff
    #else
    --lowCov
    #end if
    > '$report'
]]></command>
    <inputs>
        <param argument="--bamFile" type="data" format="bam" label="BAM file generated by groot alignment"/>
        <conditional name="arg_report">
            <param argument="criteria" type="select" label="Criteria for reporting ARGs">
                <option value="cutoff" selected="true">Use coverage cutoff for reporting ARGs (--covCutoff)</option>
                <option value="lowCov">Report ARGs which don't have 5' or 3' coverage (--lowCov)</option>
            </param>
            <when value="cutoff">
                <param argument="--covCutoff" type="float" min="0" max="1.0" value="0.97" label="Coverage cutoff for reporting ARGs" />
            </when>
            <when value="lowCov"/>
        </conditional>
    </inputs>
    <outputs>
        <data name="report" format="tabular" label="${tool.name} on ${on_string}"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="bamFile" value="groot.bam" />
            <conditional name="arg_report">
                <param name="criteria" value="cutoff" />
                <param name="covCutoff" value="0.97" />
            </conditional>
            <output name="report" ftype="tabular">
                <assert_contents>
                    <has_text text="blaB-7_1_AF189304"/>
                    <has_n_lines n="1"/>
                    <has_n_columns n="4"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
**What it does**

@HELP@

The report subcommand is used to processes graph traversals and generate a resistome profile for a sample

**Output**

The output is a report in tabular format with gene, read count, gene length, coverage cigar.

Coverage cigar is present to help debug and indicates if the reference gene is covered (M) or not (D).
    ]]></help>
    <expand macro="citations"/>
</tool>
