<tool id="seurat_read10X" name="Seurat Read10X" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>- into RDS file</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version_command"/>
    <command detect_errors="exit_code"><![CDATA[
cat '$script_file' > '$hidden_output' &&
Rscript '$script_file' >> '$hidden_output' &&
ls . >> '$hidden_output'
    ]]></command>
    <configfiles>
        <configfile name="script_file"><![CDATA[
@CMD_imports@

#if $method.method == 'mtx'
seurat_obj<-Read10X(
    data.dir = ,
    gene.column = $method.gene_column,
    cell.column = $method.cell_column,
    unique.features = $method.unique_features,
    strip.suffix = $method.strip_suffix
)

#else if $method.method == 'tab'
seurat_obj<-read.table(
    "$method.input_tab",
    header = TRUE,
    row.names = 1,
    sep = "\t"
)

#end if

@CMD_rds_write_outputs@

]]></configfile>
    </configfiles>
    <inputs>
        <conditional name="method">
            <param name="method" type="select" label="Select format of input">
                <option value="mtx">Matrix</option>
                <option value="tab">tab-delimited text</option>
            </param>
            <when value="mtx">
                <param name="matrix" type="data" format="txt" label="Counts matrix with features as rows, cells as columns (.mtx)"/>
                <param name="gene_names" type="data" format="tsv,tabular" label="List of gene names (rows)"/>
                <param name="cell_barcodes" type="data" format="tsv,tabular" label="List of cell barcodes (columns)"/>
                <param name="gene_column" type="integer" value="2" label="Column of gene table to use as gene names"/>
                <param name="cell_column" type="integer" value="1" label="Column of cell table to use as cell names"/>
                <param name="unique_features" type="boolean" truevalue="TRUE" falsevalue="FALSE" checked="true" label="Make feature names unique"/>
                <param name="strip_suffix" type="boolean" truevalue="TRUE" falsevalue="FALSE" checked="false" label="Remove trailing -1 if present in all cell barcodes"/>
            </when>
            <when value="tab">
                <param name="input_tab" type="data" format="tsv,tabular" label="Expression table with features as rows, cells as columns"/>
            </when>
        </conditional>
        <expand macro="inputs_common_advanced"/>
    </inputs>
    <outputs>
        <expand macro="seurat_outputs"/>
    </outputs>
    <tests>
        <test expect_num_outputs="2">
            <!-- test1: tabular -->
            <conditional name="method">
                <param name="method" value="tab"/>
                <conditional name="method">
                    <param name="method" value="tab"/>
                    <param name="input_tab" value="counts.tsv"/>
                </conditional>
            </conditional>
            <section name="advanced_common">
                <param name="show_log" value="true"/>
            </section>
            <output name="hidden_output">
                <assert_contents>
                    <has_text_matching expression="Read10X"/>
                </assert_contents>
            </output>
            <output name="rds_out" file="rawdata2.rds" ftype="rds">
            </output>
        </test>
   </tests>
    <help><![CDATA[
Seurat
======

Seurat is an R package designed for QC, analysis, and exploration of single-cell RNA-seq data. 

Seurat aims to enable users to identify and interpret sources of heterogeneity from single-cell transcriptomic measurements, and to integrate diverse types of single-cell data.

Read 10X 
========

Load sparse data matrices provided by 10X genomics.

More details on the `seurat documentation
<https://satijalab.org/seurat/reference/read10x>`__

    ]]></help>
    <expand macro="citations"/>
</tool>