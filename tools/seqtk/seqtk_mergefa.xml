<?xml version="1.0"?>
<tool id="seqtk_mergefa" name="seqtk_mergefa" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="22.05">
    <description>Merge two FASTA/Q files into a FASTA file output</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="bio_tools"/>
    <expand macro="requirements"/>
    <expand macro="stdio"/>
    <command><![CDATA[
seqtk mergefa
-q $q
$i
$m
$r
$h
'$in_fa1'
'$in_fa2'
echo "| pigz -p ${GALAXY_SLOTS:-1} --no-name --no-time" if $in_fa1.is_of_type('fasta.gz', 'fastq.gz') else "" # > '$default'
    ]]></command>
    <inputs>
        <param name="in_fa1" type="data" format="fasta,fastq,fasta.gz,fastq.gz" label="Input FASTA/Q file #1"/>
        <param name="in_fa2" type="data" format="fasta,fastq,fasta.gz,fastq.gz" label="Input FASTA/Q file #2"/>
        <param argument="-q" type="integer" value="0" label="Quality threshold (for FASTQ)"/>
        <param argument="-i" type="boolean" truevalue="-i" falsevalue="" checked="false" label="Take intersection" />
        <param argument="-m" type="boolean" truevalue="-m" falsevalue="" checked="false" label="Convert to lowercase for ambiguous bases or conflicts (e.g., N)" />
        <param argument="-r" type="boolean" truevalue="-r" falsevalue="" checked="false" label="Pick a random allele from het" />
        <param argument="-h" type="boolean" truevalue="-h" falsevalue="" checked="false" label="Suppress hets in the input" />
    </inputs>
    <outputs>
        <data name="default" format_source="in_fa1" label="${tool.name} on ${on_string}"/>
    </outputs>
    <tests>
        <test>
            <param name="in_fa1" value="seqtk_mergefa1.fa"/>
            <param name="in_fa2" value="seqtk_mergefa2.fa"/>
            <output name="default" file="seqtk_mergefa.out" ftype="fasta"/>
        </test>
        <test>
            <param name="in_fa1" value="seqtk_mergefa1.fa"/>
            <param name="in_fa2" value="seqtk_mergefa2.fa"/>
            <param name="m" value="True" />
            <output name="default" file="seqtk_mergefa2.out" ftype="fasta"/>
        </test>
        <test>
            <param name="in_fa1" value="seqtk_mergefa1.fa.gz" ftype="fasta.gz"/>
            <param name="in_fa2" value="seqtk_mergefa2.fa.gz" ftype="fasta.gz"/>
            <param name="m" value="True" />
            <output name="default" file="seqtk_mergefa2.out.gz" ftype="fasta.gz"/>
        </test>
    </tests>
    <help><![CDATA[
**What it does**

This tool merges two FASTA or FASTQ files into a single FASTA file using IUPAC ambiguity codes where appropriate. 
When differences occur between the sequences, ambiguity codes are used to represent possible variations. 
Additionally, if the `-m` option is set, the tool highlights conflicts by converting nucleotides to lowercase when one of the sequences contains an ambiguity code (e.g., `N`).

### Example:

    # seq1.fa
    >test0
    ACTGACTGAAA

    # seq2.fa
    >test0
    ACTGAMTGCGN

With the `-m` option enabled, the tool merges the sequences and handles ambiguities or conflicts as follows:

    >test0
    ACTGACTGxxa

Explanation:
- Positions with exact matches remain unchanged.
- Positions where no IUPAC code can represent the conflict are marked with placeholders (e.g., `x`).
- If one sequence contains an ambiguous base (e.g., `N`), the corresponding nucleotide in the other sequence is converted to lowercase to indicate uncertainty.

@ATTRIBUTION@
    ]]></help>
    <expand macro="citation" />
</tool>
