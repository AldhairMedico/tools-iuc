<tool id="quicktree" name="Quicktree" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="20.01" license="MIT">
    <description></description>
    <macros>
        <token name="@TOOL_VERSION@">2.5</token>
        <token name="@VERSION_SUFFIX@">0</token>
    </macros>
    <edam_topics>
        <edam_topic>topic_3293</edam_topic> <!-- phylogenetics -->
    </edam_topics>
    <edam_operations>
        <edam_operation>operation_0540</edam_operation> <!-- Phylogenetic inference (from molecular sequences) -->
    </edam_operations>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">quicktree</requirement>
        <requirement type="package" version="3.4">hmmer</requirement> <!-- for file conversion with esl-reformat-->
    </requirements>
    <version_command>quicktree -v</version_command>
    <command detect_errors="exit_code"><![CDATA[

## convert to stockholm or phylip before quicktree

#if $input_type.format == "align"
  #if $input_file.metadata.ftype == "stockholm"
    ln -s '$input_file' input.stockholm
  #else
    esl-reformat -o input.quicktree stockholm '$input_file'  ##--informat a2m
  #end if
#else
  #if $input_file.metadata.ftype == "phylip"
    ln -s '$input_file' input.phylip
  #else
    esl-reformat -o input.quicktree phylip '$input_file'
  #end if
#end if

&&
quicktree
#if $input_type.format =="align"
  -in a
#else
  -in m
#end if
-out t
input.quicktree
> '$output_tree'

    ]]></command>
    <inputs>
        <conditional name="input_type">
            <param name="format" type="select" label="Provide an alignment file or a distance matrix?">
                <option value="align">Alignment file</option>
                <option value="dist">Distance Matrix</option>
            </param>
            <when value="align">
                <param name="input_file" type="data" format="fasta,stockholm,clustal,pfam_profile" label="Alignment file" />
            </when>
            <when value="dist">
                <param name="input_file" type="data" format="pfam_profile,phylip" label="Alignment file" />
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="output_tree" format="newick" from_work_dir="output.stockholm" label="${tool.name} on ${on_string}: stockholm format"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1"><!-- test basic case -->
            <param name="format" value="align"/>
            <param name="input_file" value="example.009.AA.fasta" ftype="stockholm"/>
            <output name="output_tree" file="example.009.AA.newick" ftype="newick"/>
        </test>
    </tests>
    <help><![CDATA[

.. class:: infomark

**What it does**

TODO: Fill in help in reStructuredText format (https://docutils.sourceforge.io/docs/ref/rst/restructuredtext.html)

Usage
.....

Usage: quicktree [-options] <inputfile>
Options:
-in <m|a>        : input file is a distance matrix in phylip format (m)
                   or an alignment in stockholm format* (a, default)
-out <m|t>       : output is a distance matrix in phylip format (m) or
                   a tree in New Hampshire format

Advanced options :
-upgma           : Use the UPGMA method to construct the tree
                     (ignored for distance matrix outputs)
-kimura          : Use the kimura translation for pairwise distances
                     (ignored for distance matrix inputs)
-boot <n>        : Calcuate bootstrap values with n iterations
                     (ignored for distance matrix outputs)
-v               : print version and exit



**Input**


**Output**


    ]]></help>
    <citations>
        <citation type="doi">10.1093/oxfordjournals.molbev.a040454</citation>
    </citations>
</tool>
