<tool id="quicktree" name="Quicktree" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="20.01" license="MIT">
    <description></description>
    <macros>
        <token name="@TOOL_VERSION@">2.5</token>
        <token name="@VERSION_SUFFIX@">0</token>
    </macros>
    <edam_topics>
        <edam_topic>topic_3293</edam_topic> <!-- phylogenetics -->
    </edam_topics>
    <edam_operations>
        <edam_operation>operation_0540</edam_operation> <!-- Phylogenetic inference (from molecular sequences) -->
    </edam_operations>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">quicktree</requirement>
        <requirement type="package" version="3.4">hmmer</requirement> <!-- for file conversion with esl-reformat-->
    </requirements>
    <version_command>quicktree -v</version_command>
    <command detect_errors="exit_code"><![CDATA[

## convert alignment to stockholm before quicktree if needed
#if $input_type.format == "align"
    esl-reformat -o input.quicktree stockholm '$input_file'  ##--informat a2m
#else
    ln -s '$input_file' input.quicktree
#end if

&&

quicktree
#if $input_type.format =="align"
  -in a
#else
  -in m
#end if
-out t
input.quicktree
> '$output_tree'

    ]]></command>
    <inputs>
        <conditional name="input_type">
            <param name="format" type="select" label="Provide an alignment file or a distance matrix?">
                <option value="align">Alignment File</option>
                <option value="dist">Distance Matrix</option>
            </param>
            <when value="align">
                <param name="input_file" type="data" format="fasta,stockholm,phylip,txt" label="Alignment file" />
            </when>
            <when value="dist">
                <param name="input_file" type="data" format="phylip" label="Distance Matrix" />
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="output_tree" format="newick" from_work_dir="output.stockholm" label="${tool.name} on ${on_string}: stockholm format"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1"><!-- test 1: with fasta input (with reformat) -->
            <param name="format" value="align"/>
            <param name="input_file" value="example.009.AA.fasta" ftype="fasta"/>
            <output name="output_tree" file="example.009.AA.newick" ftype="newick"/>
        </test>
        <test expect_num_outputs="1"><!-- test 2: with stockholm input (no reformat)-->
            <param name="format" value="align"/>
            <param name="input_file" value="example.009.AA.stockholm" ftype="stockholm"/>
            <output name="output_tree" file="example.009.AA.newick" ftype="newick"/>
        </test>
        <test expect_num_outputs="1"><!-- test 3: with clustalw input -->
            <param name="format" value="align"/>
            <param name="input_file" value="example.011.AA.clw" ftype="txt"/>
            <output name="output_tree" file="example.011.AA.newick" ftype="newick"/>
        </test>
        <test expect_num_outputs="1"><!-- test 4: with phylip distance matrix input -->
            <param name="format" value="dist"/>
            <param name="input_file" value="example.001.AA.phy" ftype="phylip"/>
            <output name="output_tree" file="example.001.AA.newick" ftype="newick"/>
        </test>
        <test expect_num_outputs="1"><!-- test with phylip alignment input -->
            <param name="format" value="align"/>
            <param name="input_file" value="example.011.AA.phy" ftype="phylip"/>
            <output name="output_tree" file="example.011.AA.align.newick" ftype="newick"/>
        </test>

    </tests>
    <help><![CDATA[

.. class:: infomark

**What it does**

QuickTree is an efficient implementation of the Neighbor-Joining algorithm, capable of reconstructing phylogenies
from huge alignments in time less than the age of the universe.


**Input**

QuickTree accepts both distance matrix and multiple-sequence-aligment inputs. The former should be in PHYLIP format. The latter should be in Stockholm format, which is the native alignment format for the Pfam database.

Alignments can be supplies in various formats (fasta, phylip, clustalw) and will be converted to Stockholm format with the sreformat program,
which is part of the HMMer package (hmmer.org).


**Output**

Quicktree will output either a distance matrix (in PHYLIP format) or a Newick tree.



Usage
.....

Usage: quicktree [-options] <inputfile>
Options:
-in <m|a>        : input file is a distance matrix in phylip format (m)
                   or an alignment in stockholm format* (a, default)
-out <m|t>       : output is a distance matrix in phylip format (m) or
                   a tree in New Hampshire format

Advanced options :
-upgma           : Use the UPGMA method to construct the tree
                     (ignored for distance matrix outputs)
-kimura          : Use the kimura translation for pairwise distances
                     (ignored for distance matrix inputs)
-boot <n>        : Calcuate bootstrap values with n iterations
                     (ignored for distance matrix outputs)
-v               : print version and exit



    ]]></help>
    <citations>
        <citation type="doi">10.1093/oxfordjournals.molbev.a040454</citation>
    </citations>
</tool>
